PIPE(8)                      System Manager's Manual                     PIPE(8)




NNAAMMEE
       pipe - Postfix delivery to external command

SSYYNNOOPPSSIISS
       ppiippee [generic Postfix daemon options] command_attributes...

DDEESSCCRRIIPPTTIIOONN
       The ppiippee(8) daemon processes requests from the Postfix queue manager to
       deliver messages to external commands.  This program expects to be run
       from the mmaasstteerr(8) process manager.

       Message attributes such as sender address, recipient address and next-hop
       host name can be specified as command-line macros that are expanded
       before the external command is executed.

       The ppiippee(8) daemon updates queue files and marks recipients as finished,
       or it informs the queue manager that delivery should be tried again at a
       later time. Delivery status reports are sent to the bboouunnccee(8), ddeeffeerr(8)
       or ttrraaccee(8) daemon as appropriate.

SSIINNGGLLEE--RREECCIIPPIIEENNTT DDEELLIIVVEERRYY
       Some destinations cannot handle more than one recipient per delivery
       request. Examples are pagers or fax machines.  In addition,
       multi-recipient delivery is undesirable when prepending a DDeelliivveerreedd--ttoo::
       or XX--OOrriiggiinnaall--TToo:: message header.

       To prevent Postfix from sending multiple recipients per delivery request,
       specify

           _t_r_a_n_s_p_o_r_t__ddeessttiinnaattiioonn__rreecciippiieenntt__lliimmiitt == 11

       in the Postfix mmaaiinn..ccff file, where _t_r_a_n_s_p_o_r_t is the name in the first
       column of the Postfix mmaasstteerr..ccff entry for the pipe-based delivery
       transport.

CCOOMMMMAANNDD AATTTTRRIIBBUUTTEE SSYYNNTTAAXX
       The external command attributes are given in the mmaasstteerr..ccff file at the
       end of a service definition.  The syntax is as follows:

       cchhrroooott==_p_a_t_h_n_a_m_e (optional)
              Change the process root directory and working directory to the
              named directory. This happens before switching to the privileges
              specified with the uusseerr attribute, and before executing the
              optional ddiirreeccttoorryy==_p_a_t_h_n_a_m_e directive. Delivery is deferred in
              case of failure.

              This feature is available as of Postfix 2.3.

       ddiirreeccttoorryy==_p_a_t_h_n_a_m_e (optional)
              Change to the named directory before executing the external
              command.  The directory must be accessible for the user specified
              with the uusseerr attribute (see below).  The default working
              directory is $$qquueeuuee__ddiirreeccttoorryy.  Delivery is deferred in case of
              failure.

              This feature is available as of Postfix 2.2.

       eeooll==_s_t_r_i_n_g (optional, default: \\nn)
              The output record delimiter. Typically one would use either \\rr\\nn
              or \\nn. The usual C-style backslash escape sequences are
              recognized: \\aa \\bb \\ff \\nn \\rr \\tt \\vv \\_d_d_d (up to three octal digits)
              and \\\\.

       ffllaaggss==BBDDFFOORRXXhhqquu..>> (optional)
              Optional message processing flags. By default, a message is copied
              unchanged.

              BB      Append a blank line at the end of each message. This is
                     required by some mail user agents that recognize "FFrroomm "
                     lines only when preceded by a blank line.

              DD      Prepend a "DDeelliivveerreedd--TToo:: _r_e_c_i_p_i_e_n_t" message header with the
                     envelope recipient address. Note: for this to work, the
                     _t_r_a_n_s_p_o_r_t__ddeessttiinnaattiioonn__rreecciippiieenntt__lliimmiitt must be 1 (see
                     SINGLE-RECIPIENT DELIVERY above for details).

                     The DD flag also enforces loop detection (Postfix 2.5 and
                     later): if a message already contains a DDeelliivveerreedd--TToo::
                     header with the same recipient address, then the message is
                     returned as undeliverable. The address comparison is case
                     insensitive.

                     This feature is available as of Postfix 2.0.

              FF      Prepend a "FFrroomm _s_e_n_d_e_r _t_i_m_e___s_t_a_m_p" envelope header to the
                     message content.  This is expected by, for example, UUUUCCPP
                     software.

              OO      Prepend an "XX--OOrriiggiinnaall--TToo:: _r_e_c_i_p_i_e_n_t" message header with
                     the recipient address as given to Postfix. Note: for this
                     to work, the _t_r_a_n_s_p_o_r_t__ddeessttiinnaattiioonn__rreecciippiieenntt__lliimmiitt must be
                     1 (see SINGLE-RECIPIENT DELIVERY above for details).

                     This feature is available as of Postfix 2.0.

              RR      Prepend a RReettuurrnn--PPaatthh:: message header with the envelope
                     sender address.

              XX      Indicate that the external command performs final delivery.
                     This flag affects the status reported in "success" DSN
                     (delivery status notification) messages, and changes it
                     from "relayed" into "delivered".

                     This feature is available as of Postfix 2.5.

              hh      Fold the command-line $$oorriiggiinnaall__rreecciippiieenntt and $$rreecciippiieenntt
                     address domain part (text to the right of the right-most @@
                     character) to lower case; fold the entire command-line
                     $$ddoommaaiinn and $$nneexxtthhoopp host or domain information to lower
                     case.  This is recommended for delivery via UUUUCCPP.

              qq      Quote white space and other special characters in the
                     command-line $$sseennddeerr, $$oorriiggiinnaall__rreecciippiieenntt and $$rreecciippiieenntt
                     address localparts (text to the left of the right-most @@
                     character), according to an 8-bit transparent version of
                     RFC 822.  This is recommended for delivery via UUUUCCPP or
                     BBSSMMTTPP.

                     The result is compatible with the address parsing of
                     command-line recipients by the Postfix sseennddmmaaiill(1) mail
                     submission command.

                     The qq flag affects only entire addresses, not the partial
                     address information from the $$uusseerr, $$eexxtteennssiioonn or $$mmaaiillbbooxx
                     command-line macros.

              uu      Fold the command-line $$oorriiggiinnaall__rreecciippiieenntt and $$rreecciippiieenntt
                     address localpart (text to the left of the right-most @@
                     character) to lower case.  This is recommended for delivery
                     via UUUUCCPP.

              ..      Prepend ".." to lines starting with "..". This is needed by,
                     for example, BBSSMMTTPP software.

              >>      Prepend ">>" to lines starting with "FFrroomm ". This is
                     expected by, for example, UUUUCCPP software.

       nnuullll__sseennddeerr=_r_e_p_l_a_c_e_m_e_n_t (default: MAILER-DAEMON)
              Replace the null sender address (typically used for delivery
              status notifications) with the specified text when expanding the
              $$sseennddeerr command-line macro, and when generating a From_ or
              Return-Path: message header.

              If the null sender replacement text is a non-empty string then it
              is affected by the qq flag for address quoting in command-line
              arguments.

              The null sender replacement text may be empty; this form is
              recommended for content filters that feed mail back into Postfix.
              The empty sender address is not affected by the qq flag for address
              quoting in command-line arguments.

              Caution: a null sender address is easily mis-parsed by naive
              software. For example, when the ppiippee(8) daemon executes a command
              such as:

                  _W_r_o_n_g: command -f$sender -- $recipient

              the command will mis-parse the -f option value when the sender
              address is a null string.  For correct parsing, specify $$sseennddeerr as
              an argument by itself:

                  _R_i_g_h_t: command -f $sender -- $recipient

              This feature is available as of Postfix 2.3.

       ssiizzee=_s_i_z_e___l_i_m_i_t (optional)
              Don't deliver messages that exceed this size limit (in bytes);
              return them to the sender instead.

       uusseerr=_u_s_e_r_n_a_m_e (required)

       uusseerr=_u_s_e_r_n_a_m_e:_g_r_o_u_p_n_a_m_e
              Execute the external command with the user ID and group ID of the
              specified _u_s_e_r_n_a_m_e.  The software refuses to execute commands with
              root privileges, or with the privileges of the mail system owner.
              If _g_r_o_u_p_n_a_m_e is specified, the corresponding group ID is used
              instead of the group ID of _u_s_e_r_n_a_m_e.

       aarrggvv=_c_o_m_m_a_n_d... (required)
              The command to be executed. This must be specified as the last
              command attribute.  The command is executed directly, i.e. without
              interpretation of shell meta characters by a shell command
              interpreter.

              Specify "{" and "}" around command arguments that contain
              whitespace (Postfix 3.0 and later). Whitespace after "{" and
              before "}" is ignored.

              In the command argument vector, the following macros are
              recognized and replaced with corresponding information from the
              Postfix queue manager delivery request.

              In addition to the form ${_n_a_m_e}, the forms $_n_a_m_e and the
              deprecated form $(_n_a_m_e) are also recognized.  Specify $$$$ where a
              single $$ is wanted.

              $${{cclliieenntt__aaddddrreessss}}
                     This macro expands to the remote client network address.

                     This feature is available as of Postfix 2.2.

              $${{cclliieenntt__hheelloo}}
                     This macro expands to the remote client HELO command
                     parameter.

                     This feature is available as of Postfix 2.2.

              $${{cclliieenntt__hhoossttnnaammee}}
                     This macro expands to the remote client hostname.

                     This feature is available as of Postfix 2.2.

              $${{cclliieenntt__ppoorrtt}}
                     This macro expands to the remote client TCP port number.

                     This feature is available as of Postfix 2.5.

              $${{cclliieenntt__pprroottooccooll}}
                     This macro expands to the remote client protocol.

                     This feature is available as of Postfix 2.2.

              $${{ddoommaaiinn}}
                     This macro expands to the domain portion of the recipient
                     address.  For example, with an address _u_s_e_r_+_f_o_o_@_d_o_m_a_i_n the
                     domain is _d_o_m_a_i_n.

                     This information is modified by the hh flag for case
                     folding.

                     This feature is available as of Postfix 2.5.

              $${{eexxtteennssiioonn}}
                     This macro expands to the extension part of a recipient
                     address.  For example, with an address _u_s_e_r_+_f_o_o_@_d_o_m_a_i_n the
                     extension is _f_o_o.

                     A command-line argument that contains $${{eexxtteennssiioonn}} expands
                     into as many command-line arguments as there are
                     recipients.

                     This information is modified by the uu flag for case
                     folding.

              $${{mmaaiillbbooxx}}
                     This macro expands to the complete local part of a
                     recipient address.  For example, with an address
                     _u_s_e_r_+_f_o_o_@_d_o_m_a_i_n the mailbox is _u_s_e_r_+_f_o_o.

                     A command-line argument that contains $${{mmaaiillbbooxx}} expands to
                     as many command-line arguments as there are recipients.

                     This information is modified by the uu flag for case
                     folding.

              $${{nneexxtthhoopp}}
                     This macro expands to the next-hop hostname.

                     This information is modified by the hh flag for case
                     folding.

              $${{oorriiggiinnaall__rreecciippiieenntt}}
                     This macro expands to the complete recipient address before
                     any address rewriting or aliasing.

                     A command-line argument that contains $${{oorriiggiinnaall__rreecciippiieenntt}}
                     expands to as many command-line arguments as there are
                     recipients.

                     This information is modified by the hhqquu flags for quoting
                     and case folding.

                     This feature is available as of Postfix 2.5.

              $${{qquueeuuee__iidd}}
                     This macro expands to the queue id.

                     This feature is available as of Postfix 2.11.

              $${{rreecciippiieenntt}}
                     This macro expands to the complete recipient address.

                     A command-line argument that contains $${{rreecciippiieenntt}} expands
                     to as many command-line arguments as there are recipients.

                     This information is modified by the hhqquu flags for quoting
                     and case folding.

              $${{ssaassll__mmeetthhoodd}}
                     This macro expands to the name of the SASL authentication
                     mechanism in the AUTH command when the Postfix SMTP server
                     received the message.

                     This feature is available as of Postfix 2.2.

              $${{ssaassll__sseennddeerr}}
                     This macro expands to the SASL sender name (i.e. the
                     original submitter as per RFC 4954) in the MAIL FROM
                     command when the Postfix SMTP server received the message.

                     This feature is available as of Postfix 2.2.

              $${{ssaassll__uusseerrnnaammee}}
                     This macro expands to the SASL user name in the AUTH
                     command when the Postfix SMTP server received the message.

                     This feature is available as of Postfix 2.2.

              $${{sseennddeerr}}
                     This macro expands to the envelope sender address. By
                     default, the null sender address expands to MAILER-DAEMON;
                     this can be changed with the nnuullll__sseennddeerr attribute, as
                     described above.

                     This information is modified by the qq flag for quoting.

              $${{ssiizzee}}
                     This macro expands to Postfix's idea of the message size,
                     which is an approximation of the size of the message as
                     delivered.

              $${{uusseerr}}
                     This macro expands to the username part of a recipient
                     address.  For example, with an address _u_s_e_r_+_f_o_o_@_d_o_m_a_i_n the
                     username part is _u_s_e_r.

                     A command-line argument that contains $${{uusseerr}} expands into
                     as many command-line arguments as there are recipients.

                     This information is modified by the uu flag for case
                     folding.

SSTTAANNDDAARRDDSS
       RFC 3463 (Enhanced status codes)

DDIIAAGGNNOOSSTTIICCSS
       Command exit status codes are expected to follow the conventions defined
       in <ssyysseexxiittss..hh>.  Exit status 0 means normal successful completion.

       In the case of a non-zero exit status, a limited amount of command output
       is logged, and reported in a delivery status notification.  When the
       output begins with a 4.X.X or 5.X.X enhanced status code, the status code
       takes precedence over the non-zero exit status (Postfix version 2.3 and
       later).

       After successful delivery (zero exit status) a limited amount of command
       output is logged, and reported in "success" delivery status notifications
       (Postfix 3.0 and later).  This command output is not examined for the
       presence of an enhanced status code.

       Problems and transactions are logged to ssyyssllooggdd(8).  Corrupted message
       files are marked so that the queue manager can move them to the ccoorrrruupptt
       queue for further inspection.

SSEECCUURRIITTYY
       This program needs a dual personality 1) to access the private Postfix
       queue and IPC mechanisms, and 2) to execute external commands as the
       specified user. It is therefore security sensitive.

CCOONNFFIIGGUURRAATTIIOONN PPAARRAAMMEETTEERRSS
       Changes to mmaaiinn..ccff are picked up automatically as ppiippee(8) processes run
       for only a limited amount of time. Use the command "ppoossttffiixx rreellooaadd" to
       speed up a change.

       The text below provides only a parameter summary. See ppoossttccoonnff(5) for
       more details including examples.

RREESSOOUURRCCEE AANNDD RRAATTEE CCOONNTTRROOLLSS
       In the text below, _t_r_a_n_s_p_o_r_t is the first field in a mmaasstteerr..ccff entry.

       _t_r_a_n_s_p_o_r_t__ddeessttiinnaattiioonn__ccoonnccuurrrreennccyy__lliimmiitt
       (($$ddeeffaauulltt__ddeessttiinnaattiioonn__ccoonnccuurrrreennccyy__lliimmiitt))
              Limit the number of parallel deliveries to the same destination,
              for delivery via the named _t_r_a_n_s_p_o_r_t.  The limit is enforced by
              the Postfix queue manager.

       _t_r_a_n_s_p_o_r_t__ddeessttiinnaattiioonn__rreecciippiieenntt__lliimmiitt
       (($$ddeeffaauulltt__ddeessttiinnaattiioonn__rreecciippiieenntt__lliimmiitt))
              Limit the number of recipients per message delivery, for delivery
              via the named _t_r_a_n_s_p_o_r_t.  The limit is enforced by the Postfix
              queue manager.

       _t_r_a_n_s_p_o_r_t__ttiimmee__lliimmiitt (($$ccoommmmaanndd__ttiimmee__lliimmiitt))
              Limit the time for delivery to external command, for delivery via
              the named _t_r_a_n_s_p_o_r_t.  The limit is enforced by the pipe delivery
              agent.

              Postfix 2.4 and later support a suffix that specifies the time
              unit: s (seconds), m (minutes), h (hours), d (days), w (weeks).
              The default time unit is seconds.

MMIISSCCEELLLLAANNEEOOUUSS CCOONNTTRROOLLSS

       ccoonnffiigg__ddiirreeccttoorryy ((sseeee ''ppoossttccoonnff --dd'' oouuttppuutt))
              The default location of the Postfix main.cf and master.cf
              configuration files.

       ddaaeemmoonn__ttiimmeeoouutt ((1188000000ss))
              How much time a Postfix daemon process may take to handle a
              request before it is terminated by a built-in watchdog timer.

       ddeellaayy__llooggggiinngg__rreessoolluuttiioonn__lliimmiitt ((22))
              The maximal number of digits after the decimal point when logging
              sub-second delay values.

       eexxppoorrtt__eennvviirroonnmmeenntt ((sseeee ''ppoossttccoonnff --dd'' oouuttppuutt))
              The list of environment variables that a Postfix process will
              export to non-Postfix processes.

       iippcc__ttiimmeeoouutt ((33660000ss))
              The time limit for sending or receiving information over an
              internal communication channel.

       mmaaiill__oowwnneerr ((ppoossttffiixx))
              The UNIX system account that owns the Postfix queue and most
              Postfix daemon processes.

       mmaaxx__iiddllee ((110000ss))
              The maximum amount of time that an idle Postfix daemon process
              waits for an incoming connection before terminating voluntarily.

       mmaaxx__uussee ((110000))
              The maximal number of incoming connections that a Postfix daemon
              process will service before terminating voluntarily.

       pprroocceessss__iidd ((rreeaadd--oonnllyy))
              The process ID of a Postfix command or daemon process.

       pprroocceessss__nnaammee ((rreeaadd--oonnllyy))
              The process name of a Postfix command or daemon process.

       qquueeuuee__ddiirreeccttoorryy ((sseeee ''ppoossttccoonnff --dd'' oouuttppuutt))
              The location of the Postfix top-level queue directory.

       rreecciippiieenntt__ddeelliimmiitteerr ((eemmppttyy))
              The set of characters that can separate a user name from its
              extension (example: user+foo), or a .forward file name from its
              extension (example: .forward+foo).

       ssyysslloogg__ffaacciilliittyy ((mmaaiill))
              The syslog facility of Postfix logging.

       ssyysslloogg__nnaammee ((sseeee ''ppoossttccoonnff --dd'' oouuttppuutt))
              A prefix that is prepended to the process name in syslog records,
              so that, for example, "smtpd" becomes "prefix/smtpd".

       Available in Postfix version 3.0 and later:

       ppiippee__ddeelliivveerryy__ssttaattuuss__ffiilltteerr (($$ddeeffaauulltt__ddeelliivveerryy__ssttaattuuss__ffiilltteerr))
              Optional filter for the ppiippee(8) delivery agent to change the
              delivery status code or explanatory text of successful or
              unsuccessful deliveries.

SSEEEE AALLSSOO
       qmgr(8), queue manager
       bounce(8), delivery status reports
       postconf(5), configuration parameters
       master(5), generic daemon options
       master(8), process manager
       syslogd(8), system logging

LLIICCEENNSSEE
       The Secure Mailer license must be distributed with this software.

AAUUTTHHOORR((SS))
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

       Wietse Venema
       Google, Inc.
       111 8th Avenue
       New York, NY 10011, USA



                                                                         PIPE(8)
